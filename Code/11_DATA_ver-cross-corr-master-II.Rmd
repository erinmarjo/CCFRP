---
title: "Vermilion RF Cross Correlation from Master II"
author: "Erin Johnston"
date: "12/20/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)
```

```{r libraries}

library(tidyverse)
library(here)

```

# Vermilion RF

```{r data}

full_cp_ml <- read_csv(here("Data/output", "2020-11-18_master_II.csv"))

ver_full <- full_cp_ml %>%
  filter(species == "VER")

MOCI <- read_csv(here("Data", "Central_California_MOCI.csv"))

```

# Age Subset

'A few fish are mature at around 31 cm (12 in.) and 4 years, 50% are mature at about 37 cm (15 in.) and 5 years, and all are mature by 47 cm (19 in.) and 9 years.' (pg. 210, Love)

```{r}

size_cutoff <- 31

juv_ver <- ver_full %>%
  filter(size <= size_cutoff)%>%
  group_by(drift, trip, area, site, month, day, year,
           gridcell, anglerhours) %>%
  summarise(cpue_sum = sum(cpue))%>%
  group_by(trip, area, site, month, day, year,
           gridcell) %>%
  summarise(cpue_date = mean(cpue_sum)) %>%
  group_by( area, site, year, gridcell) %>%
  summarise(cpue_cell = mean(cpue_date)) %>%
  group_by( area, site, year) %>%
  summarise(cpue_site = mean(cpue_cell))


adult_ver <- ver_full %>%
  filter(size > size_cutoff)%>%
  group_by(drift, trip, area, site, month, day, year,
           gridcell, anglerhours) %>%
  summarise(cpue_sum = sum(cpue)) %>%
  group_by(trip, area, site, month, day, year,
           gridcell) %>%
  summarise(cpue_date = mean(cpue_sum)) %>%
  group_by( area, site, year, gridcell) %>%
  summarise(cpue_cell = mean(cpue_date)) %>%
  group_by( area, site, year) %>%
  summarise(cpue_site = mean(cpue_cell))

full_ver <- ver_full %>%
  group_by(drift, trip, area, site, month, day, year,
           gridcell, anglerhours) %>%
  summarise(cpue_sum = sum(cpue))%>%
  group_by(trip, area, site, month, day, year,
           gridcell) %>%
  summarise(cpue_date = mean(cpue_sum)) %>%
  group_by( area, site, year, gridcell) %>%
  summarise(cpue_cell = mean(cpue_date)) %>%
  group_by( area, site, year) %>%
  summarise(cpue_site = mean(cpue_cell))

juv_moci_ver <- left_join(juv_ver, MOCI, by = "year")

adult_moci_ver <- left_join(adult_ver, MOCI, by = "year")

full_moci_ver <- left_join(full_ver, MOCI, by = "year")

```


## Cross correlation function loops

#### Full data with protection status included

```{r loop general setup}

headers <- data.frame(area = character(), site = character(), 
                      season = character(), lag = character(), corr_values = character())

juv_v <- headers
adult_v <- headers
full_v <- headers

area_list <- c("PB", "BL", "AN", "PL")
site_list <- c("MPA", "REF")
season_list <- c("JFM", "AMJ", "JAS", "OND")


```


```{r juv vs adult loop}

## juv loop
for(j in area_list){
  for(k in site_list){
    for(l in season_list){
      juv_combos_v <- juv_moci_ver%>%
      filter(area == j, site == k, season == l)
      cross_corr <- ccf(juv_combos_v$central_ca,
                        juv_combos_v$cpue_site, plot = F)
      lag <- cross_corr$lag
      corr_values <- cross_corr$acf
      for(m in 1:length(lag)){
      juv_v <- bind_rows(juv_v, c(area = j, site = k, season = l, 
                                     lag = lag[m], corr_values = corr_values[m]))
      }

    }
  }
}

## adult loop
for(j in area_list){
  for(k in site_list){
    for(l in season_list){
      adult_combos_v <- adult_moci_ver %>%
      filter(area == j, site == k, season == l)
      cross_corr <- ccf(adult_combos_v$central_ca,
                        adult_combos_v$cpue_site, plot = F)
      lag <- cross_corr$lag
      corr_values <- cross_corr$acf
      for(m in 1:length(lag)){
      adult_v <- bind_rows(adult_v, c(area = j, site = k, season = l, 
                                     lag = lag[m], corr_values = corr_values[m]))
      }

    }
  }
}


## full loop
for(j in area_list){
  for(k in site_list){
    for(l in season_list){
      full_combos_v <- full_moci_ver %>%
      filter(area == j, site == k, season == l)
      cross_corr <- ccf(full_combos_v$central_ca,
                        full_combos_v$cpue_site, plot = F)
      lag <- cross_corr$lag
      corr_values <- cross_corr$acf
      for(m in 1:length(lag)){
      full_v <- bind_rows(full_v, c(area = j, site = k, season = l, 
                                     lag = lag[m], corr_values = corr_values[m]))
      }

    }
  }
}

```

```{r plot set up}

## juv plot set up
vis_juv_v <- juv_v %>%
  filter(lag %in% c(-10:0))%>%
  mutate(corr_values = as.numeric(corr_values),
         lag = as.numeric(lag))

vis_juv_v$season <- factor(vis_juv_v$season, levels = c("JFM", "AMJ", "JAS", "OND"))

v_juv_moci_plot <- ggplot() +
  scale_color_manual(values = c(  "#999999" , "#009999", "#666666", "#000000"))+
  scale_fill_manual(values = c( "#999999", "#009999", "#666666", "#000000"))+
  geom_col(position = "dodge2", data = vis_juv_v, aes(lag, y = corr_values,  color = season,
                                               fill = season))+
  labs(title = "Juvenile Vermilion Rockfish Lag Correlation -MOCI", y = "correlation",
       caption = "Fig 2")+
  scale_x_continuous(limits=c(-8.5,0.5),breaks=seq(-8,0,1))+
  scale_y_continuous(limits = c(-0.6, 0.95), breaks = seq(-0.6, 0.9, 0.2), 
                     labels = c(-0.6, -0.4, -0.2, 0.0, 0.2, 0.4, 0.6, 0.8) )+
  theme_bw()+
  facet_grid(site ~ area)+
    theme(panel.grid=element_blank(),
          plot.caption = element_text(size = 8))

## adult plot set up
vis_adult_v <- adult_v %>%
  filter(lag %in% c(-10:0))%>%
  mutate(corr_values = as.numeric(corr_values),
         lag = as.numeric(lag))

vis_adult_v$season <- factor(vis_adult_v$season, levels = c("JFM", "AMJ", "JAS", "OND"))

v_adult_moci_plot <- ggplot() +
  scale_color_manual(values = c(  "#999999" , "#009999", "#666666", "#000000"))+
  scale_fill_manual(values = c( "#999999", "#009999", "#666666", "#000000"))+
  geom_col(position = "dodge2", data = vis_adult_v, aes(lag, y = corr_values,  color = season,
                                               fill = season))+
  labs(title = "Adult Vermilion Rockfish Lag Correlation -MOCI", y = "correlation",
       caption = "Fig 3")+
  scale_x_continuous(limits=c(-8.5,0.5),breaks=seq(-8,0,1))+
  scale_y_continuous(limits = c(-0.6, 0.9), breaks = seq(-0.6, 0.9, 0.2), 
                     labels = c(-0.6, -0.4, -0.2, 0.0, 0.2, 0.4, 0.6, 0.8) )+
  theme_bw()+
  facet_grid(site ~ area)+
    theme(panel.grid=element_blank(),
          plot.caption = element_text(size = 8))


## full plot set up
vis_full_v <- full_v %>%
  filter(lag %in% c(-10:0))%>%
  mutate(corr_values = as.numeric(corr_values),
         lag = as.numeric(lag))

vis_full_v$season <- factor(vis_full_v$season, levels = c("JFM", "AMJ", "JAS", "OND"))

v_full_moci_plot <- ggplot() +
  scale_color_manual(values = c(  "#999999" , "#009999", "#666666", "#000000"))+
  scale_fill_manual(values = c( "#999999", "#009999", "#666666", "#000000"))+
  geom_col(position = "dodge2", data = vis_full_v, aes(lag, y = corr_values,  color = season,
                                               fill = season))+
  labs(title = "Vermilion Rockfish Lag Correlation -MOCI", y = "correlation",
       caption = "Fig 1")+
  scale_x_continuous(limits=c(-8.5,0.5),breaks=seq(-8,0,1))+
  scale_y_continuous(limits = c(-0.6, 0.9), breaks = seq(-0.6, 0.9, 0.2), 
                     labels = c(-0.6, -0.4, -0.2, 0.0, 0.2, 0.4, 0.6, 0.8) )+
  theme_bw()+
  facet_grid(site ~ area)+
    theme(panel.grid=element_blank(),
          plot.caption = element_text(size = 8))

```


```{r fig1, fig.height= 6, fig.width= 10, fig.align= "center"}
v_juv_moci_plot
```


```{r fig2, fig.height= 6, fig.width= 10, fig.align= "center"}
v_adult_moci_plot
```


```{r fig3, fig.height= 6, fig.width= 10, fig.align= "center"}
v_full_moci_plot

```



# Without Protection Status

```{r}

headers2 <- data.frame(area = character(), season = character(), 
                       lag = character(), corr_values = character())

juv_vns <- headers2
adult_vns <- headers2
full_vns <- headers2


```



```{r no site loops}

## juv no site loop
for(j in area_list){
  for(l in season_list){
    juv_combos_vns <- juv_moci_ver %>%
      filter(area == j, season == l)
    cross_corr <- ccf(juv_combos_vns$central_ca,
                        juv_combos_vns$cpue_site, plot = F)
    lag <- cross_corr$lag
    corr_values <- cross_corr$acf
      for(m in 1:length(lag)){
      juv_vns <- bind_rows(juv_vns, c(area = j,  season = l, 
                                     lag = lag[m], corr_values = corr_values[m]))
      }

    }
}


## adult no site loop
for(j in area_list){
  for(l in season_list){
    adult_combos_vns <- adult_moci_ver %>%
      filter(area == j, season == l)
    cross_corr <- ccf(adult_combos_vns$central_ca,
                        adult_combos_vns$cpue_site, plot = F)
    lag <- cross_corr$lag
    corr_values <- cross_corr$acf
      for(m in 1:length(lag)){
      adult_vns <- bind_rows(adult_vns, c(area = j,  season = l, 
                                     lag = lag[m], corr_values = corr_values[m]))
      }

    }
}


## together no site loop
for(j in area_list){
  for(l in season_list){
    full_combos_vns <- full_moci_ver %>%
      filter(area == j, season == l)
    cross_corr <- ccf(full_combos_vns$central_ca,
                        full_combos_vns$cpue_site, plot = F)
    lag <- cross_corr$lag
    corr_values <- cross_corr$acf
      for(m in 1:length(lag)){
      full_vns <- bind_rows(full_vns, c(area = j,  season = l, 
                                     lag = lag[m], corr_values = corr_values[m]))
      }

    }
}


```


```{r}

## juv no site set up
vis_juv_vns <- juv_vns %>%
  filter(lag %in% c(-10:0))%>%
  mutate(corr_values = as.numeric(corr_values),
         lag = as.numeric(lag))

vis_juv_vns$season <- factor(vis_juv_vns$season, levels = c("JFM", "AMJ", "JAS", "OND"))

vns_juv_moci_plot <- ggplot() +
  scale_color_manual(values = c(  "#999999" , "#009999", "#666666", "#000000"))+
  scale_fill_manual(values = c( "#999999", "#009999", "#666666", "#000000"))+
  geom_col(position = "dodge2", data = vis_juv_vns, aes(lag, y = corr_values,  color = season,
                                               fill = season))+
  labs(title = "Juvenile Vermilion Rockfish Lag Correlation -MOCI", y = "correlation")+
  scale_x_continuous(limits=c(-10.5,0.5),breaks=seq(-10,0,1))+
  #scale_y_continuous(limits = c(-0.1, 0.1), breaks = seq(-0.1, 0.1, 0.1))+
  theme_bw()+
  facet_wrap(.~ area)+
    theme(panel.grid=element_blank())


## adult no site set up
vis_adult_vns <- adult_vns %>%
  filter(lag %in% c(-10:0))%>%
  mutate(corr_values = as.numeric(corr_values),
         lag = as.numeric(lag))

vis_adult_vns$season <- factor(vis_adult_vns$season, levels = c("JFM", "AMJ", "JAS", "OND"))

vns_adult_moci_plot <- ggplot() +
  scale_color_manual(values = c(  "#999999" , "#009999", "#666666", "#000000"))+
  scale_fill_manual(values = c( "#999999",  "#009999", "#666666", "#000000"))+
  geom_col(position = "dodge2", data = vis_adult_vns, aes(lag, y = corr_values,  color = season,
                                               fill = season))+
  labs(title = "Adult Vermilion Rockfish Lag Correlation -MOCI", y = "correlation")+
  scale_x_continuous(limits=c(-10.5,0.5),breaks=seq(-10,0,1))+
  #scale_y_continuous(limits = c(-0.2, 0.4), breaks = seq(-0.2, 0.4, 0.1))+
  theme_bw()+
  facet_wrap(.~ area) +
  theme(panel.grid=element_blank())


## full no site set up
vis_full_vns <- full_vns %>%
  filter(lag %in% c(-10:0))%>%
  mutate(corr_values = as.numeric(corr_values),
         lag = as.numeric(lag))

vis_full_vns$season <- factor(vis_full_vns$season, levels = c("JFM", "AMJ", "JAS", "OND"))

vns_full_moci_plot <-ggplot() +
  scale_color_manual(values = c( "#999999" ,  "#009999", "#666666", "#000000"))+
  scale_fill_manual(values = c( "#999999", "#009999", "#666666", "#000000"))+
  geom_col(position = "dodge2", data = vis_full_vns, aes(lag, y = corr_values,  color = season,
                                               fill = season))+
  labs(title = "Vermilion Rockfish Lag Correlation -MOCI", y = "correlation")+
  scale_x_continuous(limits=c(-10.5,0.5),breaks=seq(-10,0,1))+
  #scale_y_continuous(limits = c(-0.2, 0.4), breaks = seq(-0.2, 0.4, 0.1))+
  theme_bw()+
  facet_wrap(.~ area)+
    theme(panel.grid=element_blank())



```




```{r fig4, fig.height= 6, fig.width= 10, fig.align= "center"}
vns_juv_moci_plot
```


```{r fig5, fig.height= 6, fig.width= 10, fig.align= "center"}
vns_adult_moci_plot
```


```{r fig6, fig.height= 6, fig.width= 10, fig.align= "center"}
vns_full_moci_plot

```


# PDO

```{r pdo}

pdo <- read_csv(here("Data", "pdo_noaa_ncei.csv")) %>%
  transform( year = substr(date, 1,4), month = substr(date, 5, 6))%>%
  filter(year %in% c(2007:2019))%>%
  mutate(season = case_when(
    month %in% c("01", "02", "03") ~ "JFM",
    month %in% c("04", "05", "06") ~ "AMJ",
    month %in% c("07", "08", "09") ~ "JAS",
    month %in% c("10", "11", "12") ~ "OND")) %>%
  group_by(year, season) %>%
  summarise(pdo_val = mean(value)) %>%
  mutate(year = as.numeric(as.character(year)))

  
juv_pdo_ver <- left_join(juv_ver, pdo, by = "year")

adult_pdo_ver <- left_join(adult_ver, pdo, by = "year")

full_pdo_ver <- left_join(full_ver, pdo, by = "year")

```


## Cross correlation function loops

#### Protection status included

```{r PDO loop general setup}

headers <- data.frame(area = character(), site = character(), 
                      season = character(), lag = character(), corr_values = character())

juv_v_pdo <- headers
adult_v_pdo <- headers
full_v_pdo <- headers


```

```{r PDO loops}

## juv loop
for(j in area_list){
  for(k in site_list){
    for(l in season_list){
      juv_combos_v_pdo <- juv_pdo_ver %>%
      filter(area == j, site == k, season == l)
      cross_corr <- ccf(juv_combos_v_pdo$pdo_val,
                        juv_combos_v_pdo$cpue_site, plot = F)
      lag <- cross_corr$lag
      corr_values <- cross_corr$acf
      for(m in 1:length(lag)){
      juv_v_pdo <- bind_rows(juv_v_pdo, c(area = j, site = k, season = l, 
                                     lag = lag[m], corr_values = corr_values[m]))
      }

    }
  }
}

## adult loop
for(j in area_list){
  for(k in site_list){
    for(l in season_list){
      adult_combos_v_pdo <- adult_pdo_ver %>%
      filter(area == j, site == k, season == l)
      cross_corr <- ccf(adult_combos_v_pdo$pdo_val,
                        adult_combos_v_pdo$cpue_site, plot = F)
      lag <- cross_corr$lag
      corr_values <- cross_corr$acf
      for(m in 1:length(lag)){
      adult_v_pdo <- bind_rows(adult_v_pdo, c(area = j, site = k, season = l, 
                                     lag = lag[m], corr_values = corr_values[m]))
      }

    }
  }
}


## full loop
for(j in area_list){
  for(k in site_list){
    for(l in season_list){
      full_combos_v_pdo <- full_pdo_ver %>%
      filter(area == j, site == k, season == l)
      cross_corr <- ccf(full_combos_v_pdo$pdo_val,
                        full_combos_v_pdo$cpue_site, plot = F)
      lag <- cross_corr$lag
      corr_values <- cross_corr$acf
      for(m in 1:length(lag)){
      full_v_pdo <- bind_rows(full_v_pdo, c(area = j, site = k, season = l, 
                                     lag = lag[m], corr_values = corr_values[m]))
      }

    }
  }
}

```

```{r PDO plot set up}

## juv plot set up
vis_juv_v_pdo <- juv_v_pdo %>%
  filter(lag %in% c(-10:0))%>%
  mutate(corr_values = as.numeric(corr_values),
         lag = as.numeric(lag))

vis_juv_v_pdo$season <- factor(vis_juv_v_pdo$season, levels = c("JFM", "AMJ", "JAS", "OND"))

v_juv_pdo_plot <- ggplot() +
  scale_color_manual(values = c(  "#999999" , "#009999", "#666666", "#000000"))+
  scale_fill_manual(values = c( "#999999", "#009999", "#666666", "#000000"))+
  geom_col(position = "dodge2", data = vis_juv_v_pdo, aes(lag, y = corr_values,  color = season,
                                               fill = season))+
  labs(title = "Juvenile Vermilion Rockfish Lag Correlation -PDO", y = "correlation",
       caption = "Fig 1")+
  scale_x_continuous(limits=c(-8.5,0.5),breaks=seq(-8,0,1))+
  scale_y_continuous(limits = c(-0.85, 0.95), breaks = seq(-0.8, 0.9, 0.2), 
                     labels = c(-0.8, -0.6, -0.4, -0.2, 0.0, 0.2, 0.4, 0.6, 0.8) )+
  theme_bw()+
  facet_grid(site ~ area)+
    theme(panel.grid=element_blank(),
          plot.caption = element_text(size = 8))

## adult plot set up
vis_adult_v_pdo <- adult_v_pdo %>%
  filter(lag %in% c(-10:0))%>%
  mutate(corr_values = as.numeric(corr_values),
         lag = as.numeric(lag))

vis_adult_v_pdo$season <- factor(vis_adult_v_pdo$season, levels = c("JFM", "AMJ", "JAS", "OND"))

v_adult_pdo_plot <- ggplot() +
  scale_color_manual(values = c(  "#999999" , "#009999", "#666666", "#000000"))+
  scale_fill_manual(values = c( "#999999", "#009999", "#666666", "#000000"))+
  geom_col(position = "dodge2", data = vis_adult_v_pdo, aes(lag, y = corr_values,  color = season,
                                               fill = season))+
  labs(title = "Adult Vermilion Rockfish Lag Correlation -PDO", y = "correlation",
       caption = "Fig 2")+
  scale_x_continuous(limits=c(-8.5,0.5),breaks=seq(-8,0,1))+
  scale_y_continuous(limits = c(-0.6, 0.9), breaks = seq(-0.6, 0.9, 0.2), 
                     labels = c(-0.6, -0.4, -0.2, 0.0, 0.2, 0.4, 0.6, 0.8) )+
  theme_bw()+
  facet_grid(site ~ area)+
    theme(panel.grid=element_blank(),
          plot.caption = element_text(size = 8))


## full plot set up
vis_full_v_pdo <- full_v_pdo %>%
  filter(lag %in% c(-10:0))%>%
  mutate(corr_values = as.numeric(corr_values),
         lag = as.numeric(lag))

vis_full_v_pdo$season <- factor(vis_full_v_pdo$season, levels = c("JFM", "AMJ", "JAS", "OND"))

v_full_pdo_plot <- ggplot() +
  scale_color_manual(values = c(  "#999999" , "#009999", "#666666", "#000000"))+
  scale_fill_manual(values = c( "#999999", "#009999", "#666666", "#000000"))+
  geom_col(position = "dodge2", data = vis_full_v_pdo, aes(lag, y = corr_values,  color = season,
                                               fill = season))+
  labs(title = "Gopher Vermilion Lag Correlation -PDO", y = "correlation",
       caption = "Fig 3")+
  scale_x_continuous(limits=c(-8.5,0.5),breaks=seq(-8,0,1))+
  scale_y_continuous(limits = c(-0.6, 0.9), breaks = seq(-0.6, 0.9, 0.2), 
                     labels = c(-0.6, -0.4, -0.2, 0.0, 0.2, 0.4, 0.6, 0.8) )+
  theme_bw()+
  facet_grid(site ~ area)+
    theme(panel.grid=element_blank(),
          plot.caption = element_text(size = 8))

```


#### Figures PDO with protection status

```{r fig7, fig.height= 6, fig.width= 10, fig.align= "center"}

v_juv_pdo_plot

```


```{r fig8, fig.height= 6, fig.width= 10, fig.align= "center"}

v_adult_pdo_plot

```


```{r fig9, fig.height= 6, fig.width= 10, fig.align= "center"}

v_full_pdo_plot

```




#### Without Protection Status

```{r PDO no site loop setup}

headers2 <- data.frame(area = character(), season = character(), 
                       lag = character(), corr_values = character())

juv_vns_pdo <- headers2
adult_vns_pdo <- headers2
full_vns_pdo <- headers2
```

```{r PDO no site loops}

## juv no site loop
for(j in area_list){
  for(l in season_list){
    juv_combos_vns_pdo <- juv_pdo_ver %>%
      filter(area == j, season == l)
    cross_corr <- ccf(juv_combos_vns_pdo$pdo_val,
                      juv_combos_vns_pdo$cpue_site, plot = F)
    lag <- cross_corr$lag
    corr_values <- cross_corr$acf
      for(m in 1:length(lag)){
      juv_vns_pdo <- bind_rows(juv_vns_pdo, c(area = j,  season = l, 
                                     lag = lag[m], corr_values = corr_values[m]))
      }

    }
}


## adult no site loop
for(j in area_list){
  for(l in season_list){
    adult_combos_vns_pdo <- adult_pdo_ver %>%
      filter(area == j, season == l)
    cross_corr <- ccf(adult_combos_vns_pdo$pdo_val,
                      adult_combos_vns_pdo$cpue_site, plot = F)
    lag <- cross_corr$lag
    corr_values <- cross_corr$acf
      for(m in 1:length(lag)){
      adult_vns_pdo <- bind_rows(adult_vns_pdo, c(area = j,  season = l, 
                                     lag = lag[m], corr_values = corr_values[m]))
      }

    }
}


## together no site loop
for(j in area_list){
  for(l in season_list){
    full_combos_vns_pdo <- full_pdo_ver %>%
      filter(area == j, season == l)
    cross_corr <- ccf(full_combos_vns_pdo$pdo_val,
                      full_combos_vns_pdo$cpue_site, plot = F)
    lag <- cross_corr$lag
    corr_values <- cross_corr$acf
      for(m in 1:length(lag)){
      full_vns_pdo <- bind_rows(full_vns_pdo, c(area = j,  season = l, 
                                     lag = lag[m], corr_values = corr_values[m]))
      }

    }
}


```


```{r PDO no site plot setup}

## juv no site set up
vis_juv_vns_pdo <- juv_vns_pdo %>%
  filter(lag %in% c(-10:0))%>%
  mutate(corr_values = as.numeric(corr_values),
         lag = as.numeric(lag))

vis_juv_vns_pdo$season <- factor(vis_juv_vns_pdo$season, levels = c("JFM", "AMJ", "JAS", "OND"))

vns_juv_pdo_plot <- ggplot() +
  scale_color_manual(values = c(  "#999999" , "#009999", "#666666", "#000000"))+
  scale_fill_manual(values = c( "#999999", "#009999", "#666666", "#000000"))+
  geom_col(position = "dodge2", data = vis_juv_vns_pdo, aes(lag, y = corr_values,  color = season,
                                               fill = season))+
  labs(title = "Juvenile Vermilion Rockfish Lag Correlation -PDO", y = "correlation",
       caption = "Fig 4")+
  scale_x_continuous(limits=c(-10.5,0.5),breaks=seq(-10,0,1))+
  #scale_y_continuous(limits = c(-0.1, 0.1), breaks = seq(-0.1, 0.1, 0.1))+
  theme_bw()+
  facet_wrap(.~ area)+
    theme(panel.grid=element_blank())


## adult no site set up
vis_adult_vns_pdo <- adult_vns_pdo %>%
  filter(lag %in% c(-10:0))%>%
  mutate(corr_values = as.numeric(corr_values),
         lag = as.numeric(lag))

vis_adult_vns_pdo$season <- factor(vis_adult_vns_pdo$season, levels = c("JFM", "AMJ", "JAS", "OND"))

vns_adult_pdo_plot <- ggplot() +
  scale_color_manual(values = c(  "#999999" , "#009999", "#666666", "#000000"))+
  scale_fill_manual(values = c( "#999999",  "#009999", "#666666", "#000000"))+
  geom_col(position = "dodge2", data = vis_adult_vns_pdo, aes(lag, y = corr_values,  color = season,
                                               fill = season))+
  labs(title = "Adult Vermilion Rockfish Lag Correlation -PDO", y = "correlation",
       caption = "Fig 5")+
  scale_x_continuous(limits=c(-10.5,0.5),breaks=seq(-10,0,1))+
  #scale_y_continuous(limits = c(-0.2, 0.4), breaks = seq(-0.2, 0.4, 0.1))+
  theme_bw()+
  facet_wrap(.~ area) +
  theme(panel.grid=element_blank())


## full no site set up
vis_full_vns_pdo <- full_vns_pdo %>%
  filter(lag %in% c(-10:0))%>%
  mutate(corr_values = as.numeric(corr_values),
         lag = as.numeric(lag))

vis_full_vns_pdo$season <- factor(vis_full_vns_pdo$season, levels = c("JFM", "AMJ", "JAS", "OND"))

vns_full_pdo_plot <-ggplot() +
  scale_color_manual(values = c( "#999999" ,  "#009999", "#666666", "#000000"))+
  scale_fill_manual(values = c( "#999999", "#009999", "#666666", "#000000"))+
  geom_col(position = "dodge2", data = vis_full_vns_pdo, aes(lag, y = corr_values,  color = season,
                                               fill = season))+
  labs(title = "Vermilion Rockfish Lag Correlation -PDO", y = "correlation",
       caption = "Fig 6")+
  scale_x_continuous(limits=c(-10.5,0.5),breaks=seq(-10,0,1))+
  #scale_y_continuous(limits = c(-0.2, 0.4), breaks = seq(-0.2, 0.4, 0.1))+
  theme_bw()+
  facet_wrap(.~ area)+
    theme(panel.grid=element_blank())



```


#### Figures PDO without protection status

```{r fig10, fig.height= 6, fig.width= 10, fig.align= "center"}

vns_juv_pdo_plot

```


```{r fig11, fig.height= 6, fig.width= 10, fig.align= "center"}

vns_adult_pdo_plot

```


```{r fig12, fig.height= 6, fig.width= 10, fig.align= "center"}

vns_full_pdo_plot

```